{"version":3,"sources":["../../src/controllers/auth.controller.ts"],"sourcesContent":["import { NextFunction, Request, response, Response } from 'express';\nimport { User } from '@prisma/client';\nimport { CreateUserDto } from '@dtos/users.dto';\nimport { RequestWithUser } from '@interfaces/auth.interface';\nimport AuthService from '@services/auth.service';\n\nclass AuthController {\n  public authService = new AuthService();\n\n  public signUp = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: CreateUserDto = req.body;\n      const _ = await this.authService.signup(userData);\n\n      const { tokenData, findUser } = await this.authService.login(userData);\n\n      res.cookie('Authorization', tokenData.token, {\n        httpOnly: true,\n        secure: true,\n        maxAge: tokenData.expiresIn,\n        sameSite: 'none',\n      });\n\n      res.status(200).json({\n        data: {\n          id: findUser.id,\n          email: findUser.email,\n        },\n        message: 'signup + login',\n      });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public access = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const Authorization = req.cookies['Authorization'] || (req.header('Authorization') ? req.header('Authorization').split('Bearer ')[1] : '');\n      const response = await this.authService.access(Authorization);\n      res.status(200).json({ data: response, message: 'auth check' });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public logIn = async (req: Request, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: CreateUserDto = req.body;\n      const { tokenData, findUser } = await this.authService.login(userData);\n\n      res.cookie('Authorization', tokenData.token, {\n        httpOnly: true,\n        secure: true,\n        maxAge: tokenData.expiresIn,\n        sameSite: 'none',\n      });\n\n      res\n        .status(200)\n        .cookie('Authorization', tokenData.token, {\n          httpOnly: true,\n          secure: true,\n          maxAge: tokenData.expiresIn,\n          sameSite: 'none',\n        })\n        .json({\n          data: {\n            id: findUser.id,\n            email: findUser.email,\n          },\n          message: 'login',\n        });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  public logOut = async (req: RequestWithUser, res: Response, next: NextFunction): Promise<void> => {\n    try {\n      const userData: User = req.user;\n      const logOutUserData: User = await this.authService.logout(userData);\n\n      res.cookie('Authorization', '', {\n        httpOnly: true,\n        secure: true,\n        maxAge: 0,\n        sameSite: 'none',\n      });\n\n      res.status(200).json({ data: logOutUserData, message: 'logout' });\n    } catch (error) {\n      next(error);\n    }\n  };\n}\n\nexport default AuthController;\n"],"names":["AuthController","authService","AuthService","signUp","req","res","next","userData","body","_","signup","tokenData","findUser","login","cookie","token","httpOnly","secure","maxAge","expiresIn","sameSite","status","json","data","id","email","message","error","access","Authorization","cookies","header","split","response","logIn","logOut","user","logOutUserData","logout"],"mappings":"AAAA;;;;+BAgGA;;aAAA;;oDA5FwB;;;;;;AAExB,IAAA,AAAMA,iBAAN,MAAMA;;aACGC,cAAc,IAAIC,oBAAW;aAE7BC,SAAS,OAAOC,KAAcC,KAAeC,OAAsC;YACxF,IAAI;gBACF,MAAMC,WAA0BH,IAAII,IAAI;gBACxC,MAAMC,IAAI,MAAM,IAAI,CAACR,WAAW,CAACS,MAAM,CAACH;gBAExC,MAAM,EAAEI,UAAS,EAAEC,SAAQ,EAAE,GAAG,MAAM,IAAI,CAACX,WAAW,CAACY,KAAK,CAACN;gBAE7DF,IAAIS,MAAM,CAAC,iBAAiBH,UAAUI,KAAK,EAAE;oBAC3CC,UAAU,IAAI;oBACdC,QAAQ,IAAI;oBACZC,QAAQP,UAAUQ,SAAS;oBAC3BC,UAAU;gBACZ;gBAEAf,IAAIgB,MAAM,CAAC,KAAKC,IAAI,CAAC;oBACnBC,MAAM;wBACJC,IAAIZ,SAASY,EAAE;wBACfC,OAAOb,SAASa,KAAK;oBACvB;oBACAC,SAAS;gBACX;YACF,EAAE,OAAOC,OAAO;gBACdrB,KAAKqB;YACP;QACF;aAEOC,SAAS,OAAOxB,KAAcC,KAAeC,OAAsC;YACxF,IAAI;gBACF,MAAMuB,gBAAgBzB,IAAI0B,OAAO,CAAC,gBAAgB,IAAK1B,CAAAA,IAAI2B,MAAM,CAAC,mBAAmB3B,IAAI2B,MAAM,CAAC,iBAAiBC,KAAK,CAAC,UAAU,CAAC,EAAE,GAAG,EAAE,AAAD;gBACxI,MAAMC,WAAW,MAAM,IAAI,CAAChC,WAAW,CAAC2B,MAAM,CAACC;gBAC/CxB,IAAIgB,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEC,MAAMU;oBAAUP,SAAS;gBAAa;YAC/D,EAAE,OAAOC,OAAO;gBACdrB,KAAKqB;YACP;QACF;aAEOO,QAAQ,OAAO9B,KAAcC,KAAeC,OAAsC;YACvF,IAAI;gBACF,MAAMC,WAA0BH,IAAII,IAAI;gBACxC,MAAM,EAAEG,UAAS,EAAEC,SAAQ,EAAE,GAAG,MAAM,IAAI,CAACX,WAAW,CAACY,KAAK,CAACN;gBAE7DF,IAAIS,MAAM,CAAC,iBAAiBH,UAAUI,KAAK,EAAE;oBAC3CC,UAAU,IAAI;oBACdC,QAAQ,IAAI;oBACZC,QAAQP,UAAUQ,SAAS;oBAC3BC,UAAU;gBACZ;gBAEAf,IACGgB,MAAM,CAAC,KACPP,MAAM,CAAC,iBAAiBH,UAAUI,KAAK,EAAE;oBACxCC,UAAU,IAAI;oBACdC,QAAQ,IAAI;oBACZC,QAAQP,UAAUQ,SAAS;oBAC3BC,UAAU;gBACZ,GACCE,IAAI,CAAC;oBACJC,MAAM;wBACJC,IAAIZ,SAASY,EAAE;wBACfC,OAAOb,SAASa,KAAK;oBACvB;oBACAC,SAAS;gBACX;YACJ,EAAE,OAAOC,OAAO;gBACdrB,KAAKqB;YACP;QACF;aAEOQ,SAAS,OAAO/B,KAAsBC,KAAeC,OAAsC;YAChG,IAAI;gBACF,MAAMC,WAAiBH,IAAIgC,IAAI;gBAC/B,MAAMC,iBAAuB,MAAM,IAAI,CAACpC,WAAW,CAACqC,MAAM,CAAC/B;gBAE3DF,IAAIS,MAAM,CAAC,iBAAiB,IAAI;oBAC9BE,UAAU,IAAI;oBACdC,QAAQ,IAAI;oBACZC,QAAQ;oBACRE,UAAU;gBACZ;gBAEAf,IAAIgB,MAAM,CAAC,KAAKC,IAAI,CAAC;oBAAEC,MAAMc;oBAAgBX,SAAS;gBAAS;YACjE,EAAE,OAAOC,OAAO;gBACdrB,KAAKqB;YACP;QACF;;AACF;MAEA,WAAe3B"}