{"version":3,"sources":["../../src/services/users.service.ts"],"sourcesContent":["import { hash } from 'bcrypt';\nimport { PrismaClient, User } from '@prisma/client';\nimport { CreateUserDto } from '@dtos/users.dto';\nimport { HttpException } from '@exceptions/HttpException';\nimport { isEmpty } from '@utils/util';\n\nclass UserService {\n  public users = new PrismaClient().user;\n\n  public async findAllUser(): Promise<User[]> {\n    const allUser: User[] = await this.users.findMany({\n      orderBy: {\n        id: 'asc',\n      },\n      where: { active: true },\n    });\n    return allUser;\n  }\n\n  public async findUserById(userId: number): Promise<User> {\n    if (isEmpty(userId)) throw new HttpException(400, 'UserId is empty');\n\n    const findUser: User = await this.users.findUnique({ where: { id: userId } });\n    if (!findUser || (findUser && !findUser.active)) throw new HttpException(409, \"User doesn't exist\");\n\n    return findUser;\n  }\n\n  public async createUser(userData: CreateUserDto): Promise<User> {\n    if (isEmpty(userData)) throw new HttpException(400, 'userData is empty');\n\n    const findUser: User = await this.users.findUnique({ where: { email: userData.email } });\n    if (findUser) throw new HttpException(409, `This email ${userData.email} already exists`);\n\n    const hashedPassword = await hash(userData.password, 10);\n    const createUserData: User = await this.users.create({ data: { ...userData, password: hashedPassword } });\n    return createUserData;\n  }\n\n  public async updateUser(userId: number, userData: CreateUserDto): Promise<User> {\n    if (isEmpty(userData)) throw new HttpException(400, 'userData is empty');\n\n    const findUser: User = await this.users.findUnique({ where: { id: userId } });\n    if (!findUser || (findUser && !findUser.active)) throw new HttpException(409, \"User doesn't exist\");\n\n    const hashedPassword = await hash(userData.password, 10);\n    const updateUserData = await this.users.update({ where: { id: userId }, data: { ...userData, password: hashedPassword } });\n    return updateUserData;\n  }\n\n  public async deleteUser(userId: number): Promise<User> {\n    if (isEmpty(userId)) throw new HttpException(400, \"User doesn't existId\");\n\n    const findUser: User = await this.users.findUnique({ where: { id: userId } });\n    if (!findUser) throw new HttpException(409, \"User doesn't exist\");\n\n    const deleteUserData = await this.users.update({\n      where: { id: userId },\n      data: {\n        ...findUser,\n        active: false,\n      },\n    });\n    return deleteUserData;\n  }\n}\n\nexport default UserService;\n"],"names":["UserService","findAllUser","allUser","users","findMany","orderBy","id","where","active","findUserById","userId","isEmpty","HttpException","findUser","findUnique","createUser","userData","email","hashedPassword","hash","password","createUserData","create","data","updateUser","updateUserData","update","deleteUser","deleteUserData","PrismaClient","user"],"mappings":"AAAA;;;;+BAmEA;;aAAA;;wBAnEqB;wBACc;+BAEL;sBACN;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAExB,IAAA,AAAMA,cAAN,MAAMA;IAGJ,MAAaC,cAA+B;QAC1C,MAAMC,UAAkB,MAAM,IAAI,CAACC,KAAK,CAACC,QAAQ,CAAC;YAChDC,SAAS;gBACPC,IAAI;YACN;YACAC,OAAO;gBAAEC,QAAQ,IAAI;YAAC;QACxB;QACA,OAAON;IACT;IAEA,MAAaO,aAAaC,MAAc,EAAiB;QACvD,IAAIC,IAAAA,aAAO,EAACD,SAAS,MAAM,IAAIE,4BAAa,CAAC,KAAK,mBAAmB;QAErE,MAAMC,WAAiB,MAAM,IAAI,CAACV,KAAK,CAACW,UAAU,CAAC;YAAEP,OAAO;gBAAED,IAAII;YAAO;QAAE;QAC3E,IAAI,CAACG,YAAaA,YAAY,CAACA,SAASL,MAAM,EAAG,MAAM,IAAII,4BAAa,CAAC,KAAK,sBAAsB;QAEpG,OAAOC;IACT;IAEA,MAAaE,WAAWC,QAAuB,EAAiB;QAC9D,IAAIL,IAAAA,aAAO,EAACK,WAAW,MAAM,IAAIJ,4BAAa,CAAC,KAAK,qBAAqB;QAEzE,MAAMC,WAAiB,MAAM,IAAI,CAACV,KAAK,CAACW,UAAU,CAAC;YAAEP,OAAO;gBAAEU,OAAOD,SAASC,KAAK;YAAC;QAAE;QACtF,IAAIJ,UAAU,MAAM,IAAID,4BAAa,CAAC,KAAK,CAAC,WAAW,EAAEI,SAASC,KAAK,CAAC,eAAe,CAAC,EAAE;QAE1F,MAAMC,iBAAiB,MAAMC,IAAAA,YAAI,EAACH,SAASI,QAAQ,EAAE;QACrD,MAAMC,iBAAuB,MAAM,IAAI,CAAClB,KAAK,CAACmB,MAAM,CAAC;YAAEC,MAAM,qCAAKP;gBAAUI,UAAUF;;QAAiB;QACvG,OAAOG;IACT;IAEA,MAAaG,WAAWd,MAAc,EAAEM,QAAuB,EAAiB;QAC9E,IAAIL,IAAAA,aAAO,EAACK,WAAW,MAAM,IAAIJ,4BAAa,CAAC,KAAK,qBAAqB;QAEzE,MAAMC,WAAiB,MAAM,IAAI,CAACV,KAAK,CAACW,UAAU,CAAC;YAAEP,OAAO;gBAAED,IAAII;YAAO;QAAE;QAC3E,IAAI,CAACG,YAAaA,YAAY,CAACA,SAASL,MAAM,EAAG,MAAM,IAAII,4BAAa,CAAC,KAAK,sBAAsB;QAEpG,MAAMM,iBAAiB,MAAMC,IAAAA,YAAI,EAACH,SAASI,QAAQ,EAAE;QACrD,MAAMK,iBAAiB,MAAM,IAAI,CAACtB,KAAK,CAACuB,MAAM,CAAC;YAAEnB,OAAO;gBAAED,IAAII;YAAO;YAAGa,MAAM,qCAAKP;gBAAUI,UAAUF;;QAAiB;QACxH,OAAOO;IACT;IAEA,MAAaE,WAAWjB,MAAc,EAAiB;QACrD,IAAIC,IAAAA,aAAO,EAACD,SAAS,MAAM,IAAIE,4BAAa,CAAC,KAAK,wBAAwB;QAE1E,MAAMC,WAAiB,MAAM,IAAI,CAACV,KAAK,CAACW,UAAU,CAAC;YAAEP,OAAO;gBAAED,IAAII;YAAO;QAAE;QAC3E,IAAI,CAACG,UAAU,MAAM,IAAID,4BAAa,CAAC,KAAK,sBAAsB;QAElE,MAAMgB,iBAAiB,MAAM,IAAI,CAACzB,KAAK,CAACuB,MAAM,CAAC;YAC7CnB,OAAO;gBAAED,IAAII;YAAO;YACpBa,MAAM,qCACDV;gBACHL,QAAQ,KAAK;;QAEjB;QACA,OAAOoB;IACT;;aAzDOzB,QAAQ,IAAI0B,oBAAY,GAAGC,IAAI;;AA0DxC;MAEA,WAAe9B"}